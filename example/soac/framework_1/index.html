
<!DOCTYPE html>
<html lang="en" class="h-full bg-gray-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competitor Analysis - Engy.ai</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="h-full">
    <div class="min-h-full">
        <nav class="bg-indigo-600">
            <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <div class="flex items-center">
                        <div class="flex-shrink-0 text-white font-bold text-xl">
                            Engy.ai
                        </div>
                        <div class="ml-10 flex items-baseline space-x-4">
                            <div class="text-white px-3 py-2 text-sm font-medium">Competitor Analysis</div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex h-[calc(100vh-4rem)]">
            <!-- Sidebar -->
            <div class="w-64 bg-gray-800">
                <div class="h-full px-3 py-4 overflow-y-auto">
                    <ul id="agentList" class="space-y-2 font-medium"></ul>
                </div>
            </div>

            <!-- Main content -->
            <div class="flex-1 p-4">
                <div id="loading" class="text-center text-gray-500 text-xl">
                    <svg class="animate-spin h-10 w-10 mx-auto mb-4 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Loading agents...
                </div>
                <div id="error" class="hidden text-center text-red-500 text-xl"></div>
                <div id="defaultMessage" class="hidden text-center text-gray-500 text-xl">
                    Select an agent from the list to view its dashboard.
                </div>
                <iframe id="agentFrame" class="hidden w-full h-full border-0 rounded-lg shadow-lg"></iframe>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const agentList = document.getElementById('agentList');
            const agentFrame = document.getElementById('agentFrame');
            const loading = document.getElementById('loading');
            const error = document.getElementById('error');
            const defaultMessage = document.getElementById('defaultMessage');

            fetch('http://localhost:7509/get_agents')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(agents => {
                    loading.classList.add('hidden');
                    defaultMessage.classList.remove('hidden');

                    for (const [name, url] of Object.entries(agents)) {
                        const li = document.createElement('li');
                        li.innerHTML = `
                            <a href="#" class="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group">
                                <svg class="w-5 h-5 text-gray-400 transition duration-75 group-hover:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 21">
                                    <path d="M16.975 11H10V4.025a1 1 0 0 0-1.066-.998 8.5 8.5 0 1 0 9.039 9.039.999.999 0 0 0-1-1.066h.002Z"/>
                                    <path d="M12.5 0c-.157 0-.311.01-.565.027A1 1 0 0 0 11 1.02V10h8.975a1 1 0 0 0 1-.935c.013-.188.028-.374.028-.565A8.51 8.51 0 0 0 12.5 0Z"/>
                                </svg>
                                <span class="ml-3">${name}</span>
                            </a>
                        `;
                        li.querySelector('a').onclick = (e) => {
                            e.preventDefault();
                            document.querySelectorAll('#agentList a').forEach(item => item.classList.remove('bg-gray-700', 'text-white'));
                            e.currentTarget.classList.add('bg-gray-700', 'text-white');
                            agentFrame.src = url;
                            agentFrame.classList.remove('hidden');
                            defaultMessage.classList.add('hidden');
                        };
                        agentList.appendChild(li);
                    }
                })
                .catch(err => {
                    loading.classList.add('hidden');
                    error.textContent = `Error: ${err.message}`;
                    error.classList.remove('hidden');
                });
        });
    </script>
</body>
</html>
