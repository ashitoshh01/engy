
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Research Agent</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-indigo-600 mb-2">Personal Research Agent</h1>
            <h2 class="text-xl text-gray-600">Enter a person's name to start research</h2>
        </header>

        <div class="max-w-xl mx-auto">
            <div class="flex mb-6">
                <input type="text" id="name-input" placeholder="Enter person's name" class="flex-grow px-4 py-2 rounded-l-lg border-2 border-indigo-300 focus:outline-none focus:border-indigo-500">
                <button id="search-button" class="bg-indigo-500 text-white px-6 py-2 rounded-r-lg hover:bg-indigo-600 transition duration-300 ease-in-out flex items-center">
                    <span>Search</span>
                    <i class="fas fa-search ml-2"></i>
                </button>
            </div>

            <div id="loading-spinner" class="hidden text-center">
                <i class="fas fa-circle-notch fa-spin text-4xl text-indigo-500"></i>
            </div>

            <div id="results-display" class="hidden bg-white rounded-lg shadow-md p-6 mb-6">
                <h3 class="text-xl font-semibold text-indigo-600 mb-4">Basic Information</h3>
                <p id="basic-info" class="text-gray-700 mb-6"></p>
                <h3 class="text-xl font-semibold text-indigo-600 mb-4">Contact Information</h3>
                <p id="contact-info" class="text-gray-700"></p>
            </div>

            <div class="bg-gray-800 rounded-lg shadow-md p-4 mb-4">
                <h3 class="text-xl font-semibold text-white mb-4">Step Log</h3>
                <div id="step-log" class="h-48 overflow-y-auto text-green-400 font-mono text-sm"></div>
            </div>

            <div id="status-indicator" class="text-center font-semibold text-indigo-600"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script>
        const searchButton = document.getElementById('search-button');
        const nameInput = document.getElementById('name-input');
        const resultsDisplay = document.getElementById('results-display');
        const basicInfo = document.getElementById('basic-info');
        const contactInfo = document.getElementById('contact-info');
        const stepLog = document.getElementById('step-log');
        const statusIndicator = document.getElementById('status-indicator');
        const loadingSpinner = document.getElementById('loading-spinner');

        const socket = io('http://localhost:5286');

        socket.on('connect', () => {
            console.log('Connected to WebSocket');
        });

        socket.on('step_update', (data) => {
            addLogEntry(`${data.step}: ${data.message}`);
        });

        function addLogEntry(message) {
            const entry = document.createElement('div');
            entry.className = 'mb-1';
            entry.textContent = message;
            stepLog.appendChild(entry);
            stepLog.scrollTop = stepLog.scrollHeight;
        }

        searchButton.addEventListener('click', () => {
            const name = nameInput.value.trim();
            if (!name) {
                alert('Please enter a name');
                return;
            }

            resultsDisplay.classList.add('hidden');
            stepLog.innerHTML = '';
            statusIndicator.textContent = 'Searching...';
            loadingSpinner.classList.remove('hidden');

            fetch('http://localhost:5286/search', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ name: name }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Search initiated:', data);
                checkStatus(name);
            })
            .catch(error => {
                console.error('Error:', error);
                statusIndicator.textContent = 'Error: Could not initiate search';
                loadingSpinner.classList.add('hidden');
            });
        });

        function checkStatus(name) {
            fetch(`http://localhost:5286/status?name=${encodeURIComponent(name)}`)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'Completed') {
                    displayResults(data.result);
                    statusIndicator.textContent = 'Search Complete';
                    loadingSpinner.classList.add('hidden');
                } else {
                    setTimeout(() => checkStatus(name), 2000);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                statusIndicator.textContent = 'Error: Could not retrieve status';
                loadingSpinner.classList.add('hidden');
            });
        }

        function displayResults(result) {
            resultsDisplay.classList.remove('hidden');
            basicInfo.textContent = result;
        }
    </script>
</body>
</html>
