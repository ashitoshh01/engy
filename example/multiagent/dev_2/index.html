
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YC Application Evaluator</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-8">YC Application Evaluator</h1>
        
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Submit Your Idea</h2>
            <textarea id="idea-input" rows="4" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe your startup idea here..."></textarea>
            <button onclick="submitIdea()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition duration-300 ease-in-out">Evaluate Idea</button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Evaluation Agents</h2>
                <div id="agents" class="space-y-4">
                    <!-- Agents will be dynamically added here -->
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-gray-700 mb-4">Evaluation Workflow</h2>
                <div id="workflow" class="space-y-3">
                    <!-- Workflow steps will be dynamically added here -->
                </div>
            </div>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Evaluation Status</h2>
            <p id="current-status" class="text-lg text-gray-600">No evaluation in progress</p>
        </div>

        <div class="mt-8 bg-white rounded-lg shadow-md p-6">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4">Evaluation Results</h2>
            <div id="result-content" class="space-y-3">
                <!-- Results will be dynamically added here -->
            </div>
        </div>
    </div>

    <script>
        const socket = io('http://localhost:7457');
        let currentJobId = null;

        socket.on('evaluation_update', (data) => {
            updateStatus(data);
            updateWorkflowStatus(data);
        });

        function submitIdea() {
            const idea = document.getElementById('idea-input').value;
            if (!idea) {
                alert('Please enter your idea before submitting.');
                return;
            }

            fetch('http://localhost:7457/api/evaluate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ idea: idea }),
            })
            .then(response => response.json())
            .then(data => {
                currentJobId = data.job_id;
                document.getElementById('current-status').innerText = 'Evaluation started. Job ID: ' + currentJobId;
                startEvaluation();
            })
            .catch(error => console.error('Error:', error));
        }

        function startEvaluation() {
            executeNextTask(0);
        }

        function executeNextTask(taskIndex) {
            fetch(`http://localhost:7457/api/evaluate/${currentJobId}/task/${taskIndex}`, {
                method: 'POST',
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        }

        function updateStatus(data) {
            document.getElementById('current-status').innerText = `Step ${data.current_step} of ${data.total_steps}: ${data.step_description}`;
            document.getElementById('result-content').innerHTML += `
                <div class="bg-gray-100 p-4 rounded-md">
                    <p class="font-semibold text-gray-700">${data.current_agent}:</p>
                    <p class="text-gray-600 mt-2">${data.result}</p>
                </div>
            `;

            if (data.status === 'completed' && data.current_step < data.total_steps) {
                executeNextTask(data.current_step);
            } else if (data.current_step === data.total_steps) {
                document.getElementById('current-status').innerText = 'Evaluation completed!';
            }
        }

        function updateWorkflowStatus(data) {
            const steps = document.querySelectorAll('.workflow-step');
            steps.forEach((step, index) => {
                const statusElement = step.querySelector('.step-status');
                if (index < data.current_step) {
                    statusElement.innerText = 'Completed';
                    statusElement.className = 'step-status text-green-500 font-semibold';
                } else if (index === data.current_step - 1) {
                    statusElement.innerText = 'In Progress';
                    statusElement.className = 'step-status text-blue-500 font-semibold';
                } else {
                    statusElement.innerText = 'Pending';
                    statusElement.className = 'step-status text-gray-400';
                }
            });
        }

        // Fetch and display agents
        fetch('http://localhost:7457/api/agents')
            .then(response => response.json())
            .then(agents => {
                const agentsContainer = document.getElementById('agents');
                agents.forEach(agent => {
                    const agentElement = document.createElement('div');
                    agentElement.className = 'bg-gray-100 p-4 rounded-md';
                    agentElement.innerHTML = `
                        <h3 class="text-lg font-semibold text-gray-700">${agent.name}</h3>
                        <p class="text-gray-600 mt-1"><span class="font-medium">Role:</span> ${agent.role}</p>
                    `;
                    agentsContainer.appendChild(agentElement);
                });
            })
            .catch(error => console.error('Error fetching agents:', error));

        // Fetch and display workflow
        fetch('http://localhost:7457/api/workflow')
            .then(response => response.json())
            .then(workflow => {
                const workflowContainer = document.getElementById('workflow');
                workflow.forEach((step, index) => {
                    const stepElement = document.createElement('div');
                    stepElement.className = 'workflow-step flex items-center';
                    stepElement.innerHTML = `
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center mr-3">${index + 1}</div>
                        <div class="flex-grow">
                            <p class="text-gray-700">${step}</p>
                        </div>
                        <div class="step-status text-gray-400 ml-3">Pending</div>
                    `;
                    workflowContainer.appendChild(stepElement);
                });
            })
            .catch(error => console.error('Error fetching workflow:', error));
    </script>
</body>
</html>
